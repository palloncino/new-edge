<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Over the edge</title>
    <link rel="stylesheet" href="./assets/css/font.css">
    <link rel="stylesheet" href="./assets/css/global.css">
    <link rel="stylesheet" href="./assets/css/header.css">
    <link rel="stylesheet" href="./assets/css/over-the-edge/section-1-over-the-edge.css">
    <style>
        .section-1-over-the-edge {
            position: relative;
            overflow: hidden;
        }

        /* Main title */
        #section-1-over-the-edge__section-1-main-title {
            position: absolute;
            top: 0;
            left: 200px;
            margin-top: 100px;
            z-index: 20;
            transition: top 0.5s, font-size 0.5s, left 0.5s;
        }

        /* Back button */
        #section-1-over-the-edge__back-btn {
            position: absolute;
            top: calc(100% - 100px);
            left: -600px;
            transition: all 0.5s;
        }

        .section-1-over-the-edge__link-description {
            border: 1px dashed rgba(255, 0, 0, 0.392);
            position: absolute;
            max-width: 600px;
            font-family: 'Mundial Thin';
            font-size: 1.6rem;
            line-height: 2rem;
            transition: top 0.5s;
            top: 2000px;
            left: 470px;
        }

        /* Common among links */
        .section-1-over-the-edge__link-title,
        .section-1-over-the-edge__link-plus,
        .section-1-over-the-edge__link-shape {
            position: absolute;
            top: -200px;
            /* Start off-screen to avoid initial flash */
            transition: all 0.5s;
            z-index: 21;
        }

        .section-1-over-the-edge__link-title {
            border: 1px dashed rgba(17, 117, 75, 0.692);
            font-family: 'Mundial Regular';
            font-size: 1.4rem;
            line-height: 24px;
            padding-top: 0.4rem;
            width: 90px;
            white-space: nowrap;
            transition: top 0.5s, font-size 0.5s, left 0.5s, transform 0.5s;
        }

        .section-1-over-the-edge__link-plus {
            border: 1px dashed rgba(30, 0, 255, 0.392);
            width: 16px;
            height: 16px;
            background: url('https://edge.chebellagiornata.it/wp-content/themes/generic/assets/svgs/plus-button-5289F8.svg') no-repeat top;
            margin-top: 10px;
        }

        .section-1-over-the-edge__link-shape {
            border: 1px dashed rgba(255, 0, 0, 0.392);
            background: url('https://edge.chebellagiornata.it/wp-content/themes/generic/assets/svgs/shape-2-violet.svg') no-repeat center;
            width: 100px;
            height: 60px;
            transform: rotate(90deg);
        }
    </style>
</head>

<body class="page-id-42">
    <div class="outer-app-container">

        <!-- HEADER -->
        <div id="edge-header" class="edge-header">
            <div id="header-logo-container" class="header-logo-container">
                <img class="header-logo-img" src="./assets/svgs/logo.svg" alt="Edge"
                    onClick="window.location = './front-page.html';" style="cursor: pointer;" />
                <h1 class="header-logo-edge">edge</h1>
            </div>
            <div class="header-navigation-links-container">
                <div class="header-navigation-links">
                    <a class="header-navigation-link" href="/a-proposito-di-noi.html">A proposito di noi</a>
                    <a class="header-navigation-link" href="/cosa-facciamo.html">Cosa facciamo</a>
                    <a class="header-navigation-link" href="/over-the-edge.html">Over the Edge</a>
                    <a class="header-navigation-link" href="/il-gruppo.html">Il gruppo</a>
                    <a class="header-navigation-link" href="/contatti.html">Contatti</a>
                    <a class="header-navigation-link" href="#">it <span style="font-family: arial;">|</span> en</a>
                </div>
            </div>
        </div>

        <div class="inner-app-container">

            <div class="section-padded-content section-1-over-the-edge">
                <div class="section-padded-content-relative-container">

                    <div id="section-1-over-the-edge__link-1-shape" class="section-1-over-the-edge__link-shape"></div>
                    <div id="section-1-over-the-edge__link-1-plus" class="section-1-over-the-edge__link-plus plus-icon"
                        onclick="section1AboutUsSelectLink(1)"></div>
                    <div id="section-1-over-the-edge__link-1-title" class="section-1-over-the-edge__link-title"
                        data-meta-label="true">LINK 1</div>

                    <div id="section-1-over-the-edge__link-2-shape" class="section-1-over-the-edge__link-shape"></div>
                    <div id="section-1-over-the-edge__link-2-plus" class="section-1-over-the-edge__link-plus plus-icon"
                        onclick="section1AboutUsSelectLink(2)"></div>
                    <div id="section-1-over-the-edge__link-2-title" class="section-1-over-the-edge__link-title"
                        data-meta-label="true">LINK 2</div>

                    <div id="section-1-over-the-edge__link-3-shape" class="section-1-over-the-edge__link-shape"></div>
                    <div id="section-1-over-the-edge__link-3-plus" class="section-1-over-the-edge__link-plus plus-icon"
                        onclick="section1AboutUsSelectLink(3)"></div>
                    <div id="section-1-over-the-edge__link-3-title" class="section-1-over-the-edge__link-title"
                        data-meta-label="true">LINK 3</div>

                    <div id="section-1-over-the-edge__link-4-shape" class="section-1-over-the-edge__link-shape"></div>
                    <div id="section-1-over-the-edge__link-4-plus" class="section-1-over-the-edge__link-plus plus-icon"
                        onclick="section1AboutUsSelectLink(4)"></div>
                    <div id="section-1-over-the-edge__link-4-title" class="section-1-over-the-edge__link-title"
                        data-meta-label="true">LINK 4</div>

                    <div id="section-1-over-the-edge__link-5-shape" class="section-1-over-the-edge__link-shape"></div>
                    <div id="section-1-over-the-edge__link-5-plus" class="section-1-over-the-edge__link-plus plus-icon"
                        onclick="section1AboutUsSelectLink(5)"></div>
                    <div id="section-1-over-the-edge__link-5-title" class="section-1-over-the-edge__link-title"
                        data-meta-label="true">LINK 5</div>

                    <div id="section-1-over-the-edge__back-btn" class="btn btn-F69701 color-FFF"
                        onclick="section1AboutUsUnselect()" data-meta-label="true">Back
                    </div>
                </div>
            </div>

        </div>
    </div>
    <script src="./assets/js/header/header-links.js"></script>
    <script>
        const initialStyles = {};
        const TOTAL_LINKS = 5;
        const PARAGRAPH_TOP = '370px';
        const PARAGRAPH_HIDDEN = '2000px';
        const PARAGRAPH_LEFT = '470px';
        const ANIMATION_DELAY = 500; // 500 ms delay between each link animation

        let mainTitle = null;
        let backBtn = null;
        let links = [];
        let finalPositions = {}; // to store final positions after positionLinks()

        let animationInProgress = false;
        let animationTimeouts = [];

        // ----------------------------------------------------
        // CONFIGURATION FOR ROTATION VALUES
        // Adjust these values if rotation degrees need to change:
        const SELECTED_SHAPE_ROTATION = '360deg';    // Rotation for selected shape
        const UNSELECTED_SHAPE_ROTATION = '540deg';  // Rotation for unselected shape on the right side
        // ----------------------------------------------------

        document.addEventListener('DOMContentLoaded', () => {
            mainTitle = document.querySelector('#section-1-over-the-edge__section-1-main-title');
            backBtn = document.querySelector('#section-1-over-the-edge__back-btn');

            for (let i = 1; i <= TOTAL_LINKS; i++) {
                links.push({
                    shape: document.querySelector(`#section-1-over-the-edge__link-${i}-shape`),
                    plus: document.querySelector(`#section-1-over-the-edge__link-${i}-plus`),
                    title: document.querySelector(`#section-1-over-the-edge__link-${i}-title`),
                    description: document.querySelector(`#section-1-over-the-edge__link-${i}-description`)
                });
            }

            positionLinks();
            storeFinalPositions();
            setInitialIntroState();
            animationInProgress = true;
            animateLinksIntoPosition(0);

            window.addEventListener('resize', () => {
                positionLinks();
                storeFinalPositions();
            });
        });

        function storeFinalPositions() {
            for (let i = 1; i <= TOTAL_LINKS; i++) {
                const shape = document.getElementById(`section-1-over-the-edge__link-${i}-shape`);
                const plus = document.getElementById(`section-1-over-the-edge__link-${i}-plus`);
                const title = document.getElementById(`section-1-over-the-edge__link-${i}-title`);

                finalPositions[i] = {
                    shape: { left: shape.style.left, top: shape.style.top },
                    plus: { left: plus.style.left, top: plus.style.top },
                    title: { left: title.style.left, top: title.style.top }
                };
            }
        }

        function setInitialIntroState() {
            links.forEach((link) => {
                if (link.shape) {
                    link.shape.style.top = '-200px';
                    link.shape.style.transition = 'all 0.5s';
                    link.shape.style.transform = 'rotate(0deg)';
                }
                if (link.plus) {
                    link.plus.style.top = '-200px';
                    link.plus.style.transition = 'all 0.5s';
                }
                if (link.title) {
                    link.title.style.top = '-200px';
                    link.title.style.transition = 'all 0.5s';
                }
            });
        }

        function animateLinksIntoPosition(i) {
            if (i >= TOTAL_LINKS) {
                // All links placed
                captureInitialStyles();
                animationInProgress = false;
                return;
            }

            const timeoutId = setTimeout(() => {
                const link = links[i];
                const id = i + 1;
                if (link.shape) {
                    link.shape.style.left = finalPositions[id].shape.left;
                    link.shape.style.top = finalPositions[id].shape.top;
                    // Rotate 450 deg instead of 360
                    link.shape.style.transform = 'rotate(450deg)';
                }
                if (link.plus) {
                    link.plus.style.left = finalPositions[id].plus.left;
                    link.plus.style.top = finalPositions[id].plus.top;
                }
                if (link.title) {
                    link.title.style.left = finalPositions[id].title.left;
                    link.title.style.top = finalPositions[id].title.top;
                }

                animateLinksIntoPosition(i + 1);
            }, ANIMATION_DELAY);

            animationTimeouts.push(timeoutId);
        }

        function completeAnimationNow() {
            // Abort all timeouts
            animationTimeouts.forEach((t) => clearTimeout(t));
            animationTimeouts = [];

            // Immediately place all links in their final positions
            for (let i = 0; i < TOTAL_LINKS; i++) {
                const link = links[i];
                const id = i + 1;
                if (link.shape) {
                    link.shape.style.left = finalPositions[id].shape.left;
                    link.shape.style.top = finalPositions[id].shape.top;
                    link.shape.style.transform = 'rotate(450deg)';
                }
                if (link.plus) {
                    link.plus.style.left = finalPositions[id].plus.left;
                    link.plus.style.top = finalPositions[id].plus.top;
                }
                if (link.title) {
                    link.title.style.left = finalPositions[id].title.left;
                    link.title.style.top = finalPositions[id].title.top;
                }
            }

            // Capture these styles now that everything is in place
            captureInitialStyles();
            animationInProgress = false;
        }

        function captureInitialStyles() {
            captureElementStyles('section-1-over-the-edge__back-btn', backBtn);
            if (mainTitle) captureElementStyles('section-1-over-the-edge__section-1-main-title', mainTitle);

            links.forEach((link, index) => {
                const linkId = `section-1-over-the-edge__link-${index + 1}`;
                captureElementStyles(`${linkId}-shape`, link.shape);
                captureElementStyles(`${linkId}-plus`, link.plus);
                captureElementStyles(`${linkId}-title`, link.title);
                captureElementStyles(`${linkId}-description`, link.description);
            });
        }

        function captureElementStyles(id, element) {
            if (element) {
                const styleAttr = element.getAttribute('style') || '';
                initialStyles[id] = { cssText: styleAttr };
            }
        }

        function restoreElementStyles(id, element) {
            if (element && initialStyles[id]) {
                element.setAttribute('style', initialStyles[id].cssText);
            }
        }

        function positionLinks() {
            const container = document.querySelector('.section-padded-content-relative-container');
            const totalLinks = 5;
            const padding = 50;
            const verticalShift = 100;
            const verticalSpacing = 10;
            const horizontalSpacing = 10;

            const availableWidth = container.clientWidth - 2 * padding;
            const spacing = availableWidth / (totalLinks + 1);

            for (let i = 1; i <= totalLinks; i++) {
                const shape = document.getElementById(`section-1-over-the-edge__link-${i}-shape`);
                const plus = document.getElementById(`section-1-over-the-edge__link-${i}-plus`);
                const title = document.getElementById(`section-1-over-the-edge__link-${i}-title`);

                if (shape && plus && title) {
                    const centerX = padding + spacing * i;
                    const shapeWidth = shape.offsetWidth;
                    const shapeHeight = shape.offsetHeight;
                    const shapeNewTop = 100; // final shape top

                    const shapeLeft = centerX - shapeWidth / 2;
                    shape.style.left = `${shapeLeft}px`;
                    shape.style.top = `${shapeNewTop}px`;

                    const plusWidth = plus.offsetWidth;
                    const titleWidth = title.offsetWidth;

                    const combinedWidth = plusWidth + horizontalSpacing + titleWidth;
                    const combinedLeft = centerX - combinedWidth / 2;

                    // Add 10px to the final top for plus and title
                    const plusTop = shapeNewTop + shapeHeight + verticalSpacing + 10;
                    plus.style.left = `${combinedLeft}px`;
                    plus.style.top = `${plusTop}px`;

                    title.style.left = `${combinedLeft + plusWidth + horizontalSpacing}px`;
                    title.style.top = `${plusTop}px`;
                }
            }
        }

        function section1AboutUsSelectLink(id) {
            // If animation is still in progress, complete it first
            if (animationInProgress) {
                completeAnimationNow();
            }

            // Adjust main title
            if (mainTitle) {
                mainTitle.style.position = 'absolute';
                mainTitle.style.top = '200px';
                mainTitle.style.left = '0';
                mainTitle.style.fontSize = '2rem';
                mainTitle.style.transition = 'top 0.5s, font-size 0.5s, left 0.5s';
            }

            // Adjust back button
            if (backBtn) {
                backBtn.style.left = '0';
            }

            links.forEach((linkObj, index) => {
                const currentId = index + 1;
                if (currentId === id) {
                    applySelectedStyles(linkObj);
                } else {
                    applyMovingStyles(linkObj, currentId);
                }
            });
        }

        function section1AboutUsUnselect() {
            restoreElementStyles('section-1-over-the-edge__back-btn', backBtn);
            if (mainTitle) restoreElementStyles('section-1-over-the-edge__section-1-main-title', mainTitle);

            links.forEach((link, index) => {
                const linkId = `section-1-over-the-edge__link-${index + 1}`;
                restoreElementStyles(`${linkId}-shape`, link.shape);
                restoreElementStyles(`${linkId}-plus`, link.plus);
                restoreElementStyles(`${linkId}-title`, link.title);
                restoreElementStyles(`${linkId}-description`, link.description);
            });
        }


        function applySelectedStyles(link) {
            const finalShapeWidth = 270; // We know this is the final width we are setting
            const finalShapeTop = 170;   // Final top position we are setting
            const finalShapeLeft = 0;    // Final left position we are setting
            const margin = 30;           // The space we want between shape and title

            // Hide plus and description logic as before
            if (link.plus) {
                link.plus.style.visibility = 'hidden';
                link.plus.style.width = '0';
                link.plus.style.height = '0';
            }

            if (link.description) {
                link.description.style.top = '370px';
                link.description.style.left = '470px';
                link.description.style.visibility = 'visible';
                link.description.style.opacity = '1';
            }

            if (link.title) {
                // Start title hidden/small
                link.title.style.width = '0px';
                link.title.style.opacity = '0';
            }

            if (link.shape) {
                // Set initial state without transitions
                link.shape.style.transition = 'none';
                link.shape.style.width = '100px';
                link.shape.style.height = '60px';
                link.shape.style.top = '200px';
                link.shape.style.left = '-200px';
                link.shape.style.transform = 'rotate(90deg)';

                requestAnimationFrame(() => {
                    // Re-enable transitions
                    link.shape.style.transition = 'all 0.5s';

                    // Apply final shape properties
                    link.shape.style.height = '160px';
                    link.shape.style.width = `${finalShapeWidth}px`;
                    link.shape.style.top = `${finalShapeTop}px`;
                    link.shape.style.left = `${finalShapeLeft}px`;
                    link.shape.style.backgroundPosition = 'center';
                    link.shape.style.transform = `rotate(${SELECTED_SHAPE_ROTATION})`;

                    // We know the final width, top, left of the shape, so we can set the title now
                    if (link.title) {
                        const finalTitleLeft = finalShapeLeft + finalShapeWidth + margin;
                        // Set final title position and size immediately
                        link.title.style.left = `${finalTitleLeft}px`;
                        link.title.style.top = `${finalShapeTop}px`;
                        link.title.style.width = '600px';
                        link.title.style.fontSize = '4rem';
                        link.title.style.lineHeight = '4rem';
                        link.title.style.fontWeight = '700';
                        link.title.style.opacity = '1';
                    }
                });
            }
        }


        function applyMovingStyles(link, id) {
            if (link.shape) {
                link.shape.style.width = '100px';
                link.shape.style.height = '60px';
                const offsetY = 100 + (id - 1) * 80;
                link.shape.style.top = `calc(100% - ${offsetY}px)`;
                link.shape.style.left = 'calc(100% - 340px)';
                // Use the configured rotation for non-selected shapes on the right side
                link.shape.style.transform = `rotate(${UNSELECTED_SHAPE_ROTATION})`;
            }

            if (link.plus) {
                link.plus.style.visibility = 'visible';
                link.plus.style.opacity = '1';
                link.plus.style.width = '16px';
                link.plus.style.height = '16px';
                const offsetY = 100 + (id - 1) * 80;
                link.plus.style.top = `calc(100% - ${offsetY}px)`;
                link.plus.style.left = 'calc(100% - 230px)';
            }

            if (link.title) {
                link.title.style.width = '100px';
                link.title.style.top = `calc(100% - ${100 + (id - 1) * 80}px)`;
                link.title.style.left = 'calc(100% - 200px)';
                link.title.style.fontSize = '1.4rem';
                link.title.style.lineHeight = '24px';
            }

            if (link.description) {
                link.description.style.top = '2000px';
                link.description.style.left = '470px';
                link.description.style.visibility = 'hidden';
                link.description.style.opacity = '0';
            }
        }

        function toggleTransform(element, transform1, transform2) {
            if (element.style.transform === transform1) {
                element.style.transform = transform2;
            } else {
                element.style.transform = transform1;
            }
        }

        // Expose functions globally
        window.section1AboutUsSelectLink = section1AboutUsSelectLink;
        window.section1AboutUsUnselect = section1AboutUsUnselect;
    </script>
</body>

</html>