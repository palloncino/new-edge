<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./assets/css/font.css">
    <link rel="stylesheet" href="./assets/css/global.css">
    <link rel="stylesheet" href="./assets/css/land-animation.css">
    <link rel="stylesheet" href="./assets/css/header.css">
    <title>Welcome to Edge</title>
</head>

<style>
    .intro-fixed-background {
        color: #313131;
        position: fixed;
        width: 100%;
        height: calc(100vh - 100px);
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        overflow: hidden;
        opacity: 0;
        animation: fadeIn var(--FADE_IN_DURATION) ease-in forwards;
        padding: 50px 0px;
    }

    @keyframes fadeIn {
        0% {
            opacity: 0;
        }

        100% {
            opacity: 1;
        }
    }

    .rail-container {
        width: 100%;
        overflow: hidden;
        display: flex;
        align-items: center;
        position: relative;
    }

    .rail-container:not(:last-child) {
        margin-bottom: 2.6rem;
    }

    .marquee-wrapper {
        display: flex;
        height: 100%;
        align-items: center;
    }

    .rail {
        display: flex;
        align-items: center;
        width: max-content;
        height: 100%;
        transform: translateX(-50%);
        animation-timing-function: cubic-bezier(0.25, 0.1, 0.25, 1);
        animation-fill-mode: forwards;
        animation-iteration-count: 1;
    }

    .move-left {
        animation-name: spinLeft;
        animation-duration: var(--ANIMATION_DURATION);
        animation-delay: var(--ANIMATION_DELAY);
        animation-fill-mode: forwards;
    }

    .move-right {
        animation-name: spinRight;
        animation-duration: var(--ANIMATION_DURATION);
        animation-delay: var(--ANIMATION_DELAY);
        animation-fill-mode: forwards;
    }

    @keyframes spinLeft {
        0% {
            transform: translateX(0);
            /* Start from current position */
        }

        100% {
            transform: translateX(-50%);
            /* Move left */
        }
    }

    @keyframes spinRight {
        0% {
            transform: translateX(-50%);
            /* Start from offset */
        }

        100% {
            transform: translateX(0%);
            /* Move right */
        }
    }

    .rail img {
        width: auto;
        height: 100%;
        margin: 0;
    }

    .rotate-180 {
        transform: rotate(180deg);
    }

    .container-visible {
        opacity: 1 !important;
    }
</style>

<body class="intro">

    <div class="app-container">

        <!-- HEADER -->
        <div id="edge-header" class="edge-header">
            <div id="header-logo-container" class="header-logo-container">
                <img class="header-logo-img" src="./assets/svgs/logo.svg" alt="Edge" />
                <h1 class="header-logo-edge">edge</h1>
            </div>
            <div class="header-navigation-links-container">
                <div class="header-navigation-links">
                    <a class="header-navigation-link selected" href="/index.html">Home</a>
                    <a class="header-navigation-link" href="/cosa-facciamo.html">Cosa facciamo</a>
                    <a class="header-navigation-link" href="/chi-siamo.html">Chi siamo</a>
                    <a class="header-navigation-link" href="/il-gruppo.html">Il gruppo</a>
                    <a class="header-navigation-link" href="/download.html">Download</a>
                    <a class="header-navigation-link" href="/contatti.html">Contatti</a>
                    <a class="header-navigation-link" href="#">it | en</a>
                </div>
            </div>
        </div>

    </div>

    <!-- LAND ANIMATION -->

    <div id="intro-fixed-background" class="intro-fixed-background">


        <style>
            .intro-header-logo-container {
                display: none;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .intro-header-logo-img {
                /* 
                height: 120px;
                width: 65.85px; 
            */
            }

            .intro-header-logo-edge {
                text-transform: uppercase;
                font-family: 'Mundial Regular';
                font-size: 56px;
                margin-bottom: 0;
                margin-top: 25px;
                transition: all 1s ease-in-out;
            }

            #intro-header-logo-container {
                opacity: 0;
                position: fixed;
                top: 50%;
                transform: translateY(-50%);
                left: 300px;
                height: 250px;
                width: 150px;
                background: rgba(77, 115, 77, 0.725);
                transition: all 1s ease-in-out;
            }

            #text-container {
                opacity: 0;
                position: fixed;
                top: 50%;
                transform: translateY(-50%);
                left: 500px;
                height: 200px;
                width: 100%;
                max-width: 1100px;
                /*  */
            }

            #text-container__h1 {
                font-size: 100px;
                line-height: 100px;
                text-wrap: nowrap;
                margin: 0;
            }

            #text-container,
            #text-container__h1 {
                transition: all 1s ease-in-out;
            }
        </style>

        <div id="intro-header-logo-container" class="intro-header-logo-container">
            <img class="intro-header-logo-img" id="intro-header-logo-img" src="./assets/svgs/logo.svg" alt="Edge" />
            <h1 class="intro-header-logo-edge" id="intro-header-logo-edge">edge</h1>
        </div>

        <div id="text-container">
            <h1 class="Heading" id="text-container__h1">YOUR CARE,<br />UNLIMITED</h1>
        </div>

        <!-- Rail Containers for the Marquee Effect -->
        <div class="rail-container">
            <div class="marquee-wrapper">
                <div class="rail rail-1 move-left"></div>
            </div>
        </div>
        <div class="rail-container">
            <div class="marquee-wrapper">
                <div class="rail rail-2 move-right"></div>
            </div>
        </div>
        <div class="rail-container">
            <div class="marquee-wrapper">
                <div class="rail rail-3 move-left"></div>
            </div>
        </div>
        <div class="rail-container">
            <div class="marquee-wrapper">
                <div class="rail rail-4 move-right"></div>
            </div>
        </div>
    </div>
</body>

<!-- <script src="./assets/js/land-animation.js"></script> -->
<script>

    const EDGE_HEADER = document.getElementById('edge-header');
    const HEADER_LOGO_CONTAINER = document.getElementById('header-logo-container');

    const LOGO_CONTAINER = document.getElementById('intro-header-logo-container');
    const LOGO_CONTAINER_EDGE_IMG = document.getElementById('intro-header-logo-img');
    const LOGO_CONTAINER_EDGE_H1 = document.getElementById('intro-header-logo-edge');

    const TEXT_CONTAINER = document.getElementById('text-container');

    let selectedShape = null;

    const FADE_IN_DURATION = "1s";
    const ANIMATION_DURATION = "3s";
    const ANIMATION_DELAY = "1s";
    const POST_ANIMATION_PAUSE = 1000;
    const RAIL_HEIGHT_GAP = 48;
    const ANIMATION_TOTAL_DURATION = 5000;
    const FINAL_SHAPE_HEIGHT = 50;
    const LOGO_CONTAINER_WIDTH = 48;
    const LOGO_CONTAINER_HEIGHT = 105;

    // Set CSS variables for durations
    document.documentElement.style.setProperty('--FADE_IN_DURATION', FADE_IN_DURATION);
    document.documentElement.style.setProperty('--ANIMATION_DURATION', ANIMATION_DURATION);
    document.documentElement.style.setProperty('--ANIMATION_DELAY', ANIMATION_DELAY);

    function getCenteredOrangeShape() {
        const viewportCenter = window.innerWidth / 2;

        const rail2 = document.querySelector('.rail-2');
        const shapes = rail2.querySelectorAll('img');

        let closestDistance = Infinity;

        shapes.forEach((shape) => {
            if (shape.src.includes('orange')) {
                const shapeRect = shape.getBoundingClientRect();
                const shapeCenter = shapeRect.left + shapeRect.width / 2;

                const distanceFromCenter = Math.abs(viewportCenter - shapeCenter);

                if (distanceFromCenter < closestDistance) {
                    selectedShape = shape;
                    closestDistance = distanceFromCenter;
                }
            }
        });

        if (selectedShape) {
            selectedShape.id = 'selectedOrangeShape';
        }

        enterSecondPhase();
    }

    function enterSecondPhase() {
        const clonedShape = selectedShape.cloneNode(true);
        document.body.appendChild(clonedShape);

        const selectedShapeRect = selectedShape.getBoundingClientRect();

        clonedShape.style.position = 'absolute';
        clonedShape.style.top = `${selectedShapeRect.top}px`;
        clonedShape.style.left = `${selectedShapeRect.left}px`;
        clonedShape.style.width = `${selectedShapeRect.width}px`;
        clonedShape.style.height = `${selectedShapeRect.height}px`;
        clonedShape.style.transform = 'none';
        clonedShape.style.transition = 'none';

        const rails = document.querySelectorAll('.rail');
        rails.forEach((rail) => {
            rail.querySelectorAll('img').forEach((img) => {
                if (img !== selectedShape) {
                    img.style.transition = `opacity ${FADE_IN_DURATION} ease-in-out`;
                    img.style.opacity = '0';
                }
            });
        });

        setTimeout(() => {
            rails.forEach((rail) => {
                if (!rail.contains(selectedShape)) {
                    rail.style.display = 'none';
                }
            });

            selectedShape.style.display = 'none';

            enterThirdPhase(clonedShape);
        }, POST_ANIMATION_PAUSE);
    }

    function enterThirdPhase(selectedOrangeShape) {
        const introBackground = document.querySelector('.intro-fixed-background');
        const rails = document.querySelectorAll('.rail-container');
        rails.forEach(rail => rail.remove());

        LOGO_CONTAINER.style.opacity = '1';
        TEXT_CONTAINER.style.opacity = '1';
        

        const logoRect = LOGO_CONTAINER.getBoundingClientRect();
        const finalTop = logoRect.top + window.scrollY + (logoRect.height / 2) - (FINAL_SHAPE_HEIGHT / 2);
        const finalLeft = logoRect.left + window.scrollX + (logoRect.width / 2) - (LOGO_CONTAINER_WIDTH / 2);

        selectedOrangeShape.style.position = 'fixed';
        selectedOrangeShape.style.transition = 'top 1s ease-in-out, left 1s ease-in-out, width 1s ease-in-out, height 1s ease-in-out';
        selectedOrangeShape.style.top = `${finalTop}px`;
        selectedOrangeShape.style.left = `${finalLeft}px`;
        selectedOrangeShape.style.width = `${LOGO_CONTAINER_WIDTH}px`;
        selectedOrangeShape.style.height = `${FINAL_SHAPE_HEIGHT}px`;

        setTimeout(() => {
            enterFourthPhase();
        }, 2000);
    }

    function enterFourthPhase() {
        const textContainerH1 = document.getElementById('text-container__h1');
        const headerLogoRect = HEADER_LOGO_CONTAINER.getBoundingClientRect();
        const selectedOrangeShape = document.getElementById('selectedOrangeShape');
        selectedOrangeShape.style.display = 'none';

        // Reset logoContainer properties to match headerLogoRect
        LOGO_CONTAINER.style.transform = 'none';
        LOGO_CONTAINER.style.position = 'fixed';
        LOGO_CONTAINER.style.top = `${headerLogoRect.top}px`;
        LOGO_CONTAINER.style.left = `${headerLogoRect.left}px`;
        LOGO_CONTAINER.style.width = `${headerLogoRect.width}px`;
        LOGO_CONTAINER.style.height = `${headerLogoRect.height}px`;
        
        LOGO_CONTAINER_EDGE_H1.style.fontSize = '24px';
        LOGO_CONTAINER_EDGE_H1.style.marginTop = '20px';

        HEADER_LOGO_CONTAINER.style.opacity = '.0';

        EDGE_HEADER.style.transition = 'opacity 1s';
        EDGE_HEADER.style.opacity = '1';

        // Reset textContainer and textContainerH1 styles
        TEXT_CONTAINER.style.left = `200px`;
        TEXT_CONTAINER.style.height = `auto`;
        textContainerH1.style.fontSize = `130px`;
        textContainerH1.style.lineHeight = `115px`;
    }

    function applyAnimationPauseAndSelectShape() {
        setTimeout(() => {
            getCenteredOrangeShape();
        }, ANIMATION_TOTAL_DURATION);
    }

    function calculateAndSetRailHeight() {
        const viewportHeight = window.innerHeight;
        const railHeight = (viewportHeight - (3 * RAIL_HEIGHT_GAP)) / 4;
        const railContainers = document.querySelectorAll('.rail-container');
        railContainers.forEach(container => {
            container.style.height = `${railHeight}px`;
        });
    }

    function populateRails() {
        const rails = document.querySelectorAll('.rail');

        rails.forEach((rail, index) => {
            for (let i = 0; i < 30; i++) {
                const img = document.createElement('img');

                if (index === 0 || index === 2) {
                    img.src = (i % 2 === 0) ? './assets/svgs/shape-3-violet.svg' : './assets/svgs/shape-2-lightblue.svg';
                    if (img.src.includes('lightblue')) {
                        img.classList.add('rotate-180');
                    }
                } else if (index === 1 || index === 3) {
                    img.src = (i % 2 === 0) ? './assets/svgs/shape-3-pink.svg' : './assets/svgs/shape-2-orange.svg';
                    if (img.src.includes('pink')) {
                        img.classList.add('rotate-180');
                    }
                }

                img.alt = 'Shape';
                rail.appendChild(img);
            }
        });
    }

    function setInitialRailPositions() {
        const rails = document.querySelectorAll('.rail');
        rails.forEach((rail, index) => {
            // Set initial position based on direction
            if (index % 2 === 0) {
                rail.style.transform = 'translateX(0)'; // For left-moving rails
            } else {
                rail.style.transform = 'translateX(-50%)'; // For right-moving rails
            }
        });
    }

    function setEdgeHeader() {
        EDGE_HEADER.style.opacity = '0';
    }

    window.onload = function () {
        setEdgeHeader();
        setInitialRailPositions();
        calculateAndSetRailHeight();
        populateRails();
        applyAnimationPauseAndSelectShape();
    };




</script>

</html>